"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[308],{57308:(E,T,a)=>{a.r(T),a.d(T,{TitiModule:()=>M});var u=a(69808),f=a(71787),v=a(17489),d=a(28321),c=a(11730),i=a(5e3),m=a(53405),S=a(74696),P=a(31657),y=a(92134),g=a(47423),C=a(11523),w=a(75303);const D=[{path:"",component:(()=>{class n{constructor(t,e,r,l){this.graphService=t,this.echartService=e,this.web3Service=r,this.refreshService=l,this.totalStakedTiTi=0,this.totalTiTiSupply=0,this.titiDailyPrice=[0],this.TiUSDDailyPrice=[],this.option={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchTiUSDChartData(),this.fetchCurrentEpochInfo(),this.fetchTiTiTotalSupply(),this.fetchOptions()]).then(()=>this.buildOption())}buildOption(){this.option.series[0].data=this.titiDailyPrice,this.option=(0,v.cloneDeep)(this.option)}fetchOptions(){return this.echartService.fetchOption("TiTi-Price").then(t=>this.option=t)}fetchTiUSDChartData(){return this.graphService.fetchMMFSwapPairDailyData(c.wE.MAMMSwapPair).then(({data:t})=>{var e;this.TiUSDDailyPrice=Array(30).fill(null);const r=(0,d.Gq)().reverse();null===(e=t.pair)||void 0===e||e.pairDailyData.forEach(p=>{const o=r.indexOf(1e3*p.dayStartTimestamp);-1!==o&&(this.TiUSDDailyPrice[o]=p.token0Price)});let l=1;return this.TiUSDDailyPrice.forEach((p,o)=>{null==p?this.TiUSDDailyPrice[o]=l:l=p}),this.fetchUniwapPairDailyData()})}fetchUniwapPairDailyData(){return Promise.all([this.graphService.fetchUniwapPairDailyData(),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[])]).then(([{data:t},e])=>{const r=Array(30).fill(null),l=(0,d.Gq)().reverse();0===t.uniswapPair.dailyData.length?r.fill(e[1]/e[0]):t.uniswapPair.dailyData.forEach(o=>{const s=l.indexOf(1e3*o.dayStartTimestamp);-1!==s&&(r[s]=o.fund1/o.fund0)});let p="0";r.forEach((o,s)=>{null==o?r[s]=p/this.TiUSDDailyPrice[s]:(r[s]=o/this.TiUSDDailyPrice[s],p=r[s])}),this.titiDailyPrice=r})}fetchCurrentEpochInfo(){return this.web3Service.invokeContract("TiTiBackendV1","epochNum",[]).then(t=>{this.fetchTiTiStakingInfoByEpoch(t[0])})}fetchTiTiStakingInfoByEpoch(t){return this.web3Service.invokeContract("TiTiStaking","totalTiTi",[]).then(e=>{this.totalStakedTiTi=e[0]/10**18})}fetchTiTiTotalSupply(){return Promise.all([this.web3Service.invokeContract("TiTiToken","totalSupply",[]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.wE.MMFLPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.wE.LPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.il]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.Lg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.cr]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.Ew]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.xo]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.vl]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.Hg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.wj])]).then(([t,e,r,l,p,o,s,Z,A,k,U])=>{this.totalTiTiSupply=(t[0]-e[0]-r[0]-l[0]-p[0]-o[0]-s[0]-Z[0]-A[0]-k[0]-U[0])/10**18})}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(m.h),i.Y36(S.p),i.Y36(c.Uc),i.Y36(P.g))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-titi"]],decls:26,vars:14,consts:[[1,"titi-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","TiTi price calculated based on Uniswap and MAMM"],[1,"value"],["href","https://app.uniswap.org/#/swap?inputCurrency=0x6EFF556748Ee452CbDaf31bcb8c76A28651509bd&outputCurrency=0x3bdffA70f4b4E6985eED50453c7C0D4A15dcEc52","target","_blank",1,"action-btn"],["mat-raised-button","","color","primary",2,"width","100%"],["text","Proportion of staked TiTi in total circulation"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"h2",2),i._uU(3,"TiTi Price "),i._UZ(4,"titi-tooltip",3),i.qZA(),i.TgZ(5,"span",4),i._uU(6),i.ALo(7,"numberFormat"),i.qZA(),i.TgZ(8,"a",5),i.TgZ(9,"button",6),i._uU(10,"BUY"),i.qZA(),i.qZA(),i.qZA(),i.TgZ(11,"div",1),i.TgZ(12,"h2",2),i._uU(13,"TiTi Circulation"),i.qZA(),i.TgZ(14,"span",4),i._uU(15),i.ALo(16,"numberFormat"),i.qZA(),i.qZA(),i.TgZ(17,"div",1),i.TgZ(18,"h2",2),i._uU(19,"Staked Ratio "),i._UZ(20,"titi-tooltip",7),i.qZA(),i.TgZ(21,"span",4),i._uU(22),i.ALo(23,"numberFormat"),i.qZA(),i.qZA(),i.TgZ(24,"div",8),i._UZ(25,"titi-chart-wrapper",9),i.qZA(),i.qZA()),2&t&&(i.xp6(6),i.hij("$",i.xi3(7,5,e.titiDailyPrice[e.titiDailyPrice.length-1],4),""),i.xp6(9),i.Oqu(i.xi3(16,8,e.totalTiTiSupply,4)),i.xp6(7),i.hij("",0===e.totalTiTiSupply?0:i.xi3(23,11,100*e.totalStakedTiTi/e.totalTiTiSupply,4),"%"),i.xp6(3),i.Q6J("option",e.option)("showTitle",!0))},directives:[y.Q,g.lW,C.o],pipes:[w.p],styles:[".titi-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px;line-height:36px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:calc(100vh - 280px)}@media screen and (max-width: 1024px){.titi-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px;height:auto}}"]}),n})()}];let b=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[f.Bz.forChild(D)],f.Bz]}),n})();var O=a(45922),x=a(87841);let M=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[u.ez,b,O.F,x.m,g.ot]]}),n})()}}]);