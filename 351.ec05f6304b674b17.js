"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[351],{28321:($,R,r)=>{function g(){const a=(new Date).getTime(),u=[];let h=36e5*parseInt(a/36e5+"");for(let p=0;p<720;p++)u.push(h),h-=36e5;return u}function w(){const a=(new Date).getTime(),u=[];let h=864e5*parseInt(a/864e5+"");for(let p=0;p<30;p++)u.push(h),h-=864e5;return u}function U(){const a=(new Date).getTime();return 86400*parseInt(a/864e5+"")-2592e3}function S(s){return s>0?[parseInt(s/864e5+"")+"d",parseInt(s%864e5/36e5+"")+"h",parseInt(s%36e5/6e4+"")+"m",parseInt(s%6e4/1e3+"")+"s"].join(":"):[" -- d"," -- h"," -- m"," -- s"].join(":")}function t(s){let a=s;const u=a.substring(0,1),h=a.substring(1,2);if(a.length>1&&"0"===u&&"."!==h&&(a=a.substring(1,2)),"."===u&&(a=""),-1!==a.indexOf(".")){let p=a.substring(a.indexOf(".")+1);-1!==p.indexOf(".")&&(a=a.substring(0,a.indexOf(".")+p.indexOf(".")+1))}return a=a.replace(/[^\d^\.]+/g,""),a}r.d(R,{jn:()=>g,Gq:()=>w,Mv:()=>U,lR:()=>S,Y4:()=>t})},10351:($,R,r)=>{r.r(R),r.d(R,{ActivityModule:()=>P});var g=r(69808),w=r(71787),U=r(5963),x=r(54004),S=r(28321),t=r(5e3),b=r(31657),s=r(32681),a=r(47423),u=r(85899),h=r(75303);function p(i,d){1&i&&(t.TgZ(0,"a",12),t._uU(1,"Swap TiTi in Uniswap-V2"),t.qZA())}function A(i,d){1&i&&(t.TgZ(0,"a",13),t._uU(1,"Buy TiUSD in TiTi-AMMs"),t.qZA())}function C(i,d){if(1&i&&(t.TgZ(0,"div"),t._UZ(1,"mat-progress-bar",18),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("value",n.activityData[e.uuid])}}function M(i,d){if(1&i&&(t.TgZ(0,"div",19),t._uU(1),t.ALo(2,"async"),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,n.activityData[e.uuid])," ")}}function O(i,d){if(1&i&&(t.TgZ(0,"div",19),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.hij(" ",n.activityData[e.uuid]," ")}}function _(i,d){if(1&i&&(t.TgZ(0,"div",19),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,n.activityData[e.uuid],4)," TiTi ")}}function E(i,d){if(1&i&&(t.TgZ(0,"div",14),t.TgZ(1,"div",15),t._uU(2),t.qZA(),t.YNc(3,C,2,1,"div",16),t.YNc(4,M,3,3,"div",17),t.YNc(5,O,2,1,"div",17),t.YNc(6,_,3,4,"div",17),t.qZA()),2&i){const e=d.$implicit;t.xp6(2),t.hij("",e.lable,":"),t.xp6(1),t.Q6J("ngIf","processbar"===e.type),t.xp6(1),t.Q6J("ngIf","countdown"===e.type),t.xp6(1),t.Q6J("ngIf","common"===e.type),t.xp6(1),t.Q6J("ngIf","decimal"===e.type)}}function l(i,d){if(1&i&&(t.ynx(0),t.TgZ(1,"p",20),t._uU(2),t.qZA(),t.BQk()),2&i){const e=t.oxw().$implicit;t.xp6(2),t.hij("",e.text," ")}}function T(i,d){if(1&i&&(t.ynx(0),t.TgZ(1,"div",21),t.TgZ(2,"span",22),t._uU(3," \xb7 "),t.qZA(),t.TgZ(4,"p",23),t._uU(5),t.qZA(),t.qZA(),t.BQk()),2&i){const e=t.oxw().$implicit;t.xp6(5),t.hij(" ",e.text," ")}}function v(i,d){if(1&i&&(t.ynx(0),t.YNc(1,l,3,1,"ng-container",16),t.YNc(2,T,6,1,"ng-container",16),t.BQk()),2&i){const e=d.$implicit;t.xp6(1),t.Q6J("ngIf","Q"===e.type),t.xp6(1),t.Q6J("ngIf","A"===e.type)}}const f=[{path:"",component:(()=>{class i{constructor(e,n,c,o){this.refreshService=e,this.activedRoute=n,this.location=c,this.use2earnService=o,this.activityName=""}getCounter(e){const n=new Date(e);return(0,U.H)(0,1e3).pipe((0,x.U)(()=>(0,S.lR)(n.getTime()-(new Date).getTime())))}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchUserData().then(()=>this.getActivityInfo()).then(()=>this.getActivityData()).then(e=>this.rebuildData(e)).then(e=>this.activityData=e)}fetchUserData(){return this.use2earnService.fetchUserData()}getActivityInfo(){return this.activityName=this.activedRoute.snapshot.paramMap.get("activityName"),fetch(`/assets/activity/${this.activityName}.json`).then(e=>e.text()).then(e=>this.activityInfo=JSON.parse(e))}getActivityData(){let e={};const n=(new Date).getTime(),c=1e3*this.use2earnService.currentEpochInfo.starttime,o=1e3*this.use2earnService.currentEpochInfo.duration;switch(this.activityName){case"buyTiUSD":e={activityProgress:n-c<o?100*(n-c)/o:100,activityCountdown:c+o,totalRewards:this.use2earnService.buyTiUSDReward,claimableRewards:this.use2earnService.buyTiUSDPersonalReward-this.use2earnService.buyTiUSDPersonalRewardRate>0?this.use2earnService.buyTiUSDPersonalReward-this.use2earnService.buyTiUSDPersonalRewardRate:0};break;case"holdTiUSD":e={activityProgress:n-c<o?100*(n-c)/o:100,activityCountdown:c+o,totalRewards:this.use2earnService.holdTiUSDReward,claimableRewards:this.use2earnService.holdTiUSDPersonalReward};break;case"buyTiTi":e={activityProgress:n-c<o?100*(n-c)/o:100,activityCountdown:c+o,totalRewards:this.use2earnService.buyTiTiReward,claimableRewards:this.use2earnService.buyTiTiPersonalReward-this.use2earnService.buyTiTiPersonalRewardRate}}return e}rebuildData(e){var n;return null===(n=this.activityInfo)||void 0===n||n.metadata.forEach((c,o)=>{"countdown"===c.type&&(e[c.uuid]=this.getCounter(e[c.uuid]))}),e}goBack(){this.location.back()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(b.g),t.Y36(w.gz),t.Y36(g.Ye),t.Y36(s.Q))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-activity"]],decls:16,vars:5,consts:[[1,"activity-wrapper"],[1,"activity-card","mat-elevation-z4"],[1,"activity-title"],["mat-button","","color","primary",1,"back-btn",3,"click"],["href","https://app.uniswap.org/#/swap?inputCurrency=0x6EFF556748Ee452CbDaf31bcb8c76A28651509bd&outputCurrency=0x3bdffA70f4b4E6985eED50453c7C0D4A15dcEc52","target","_blank",4,"ngIf"],["routerLink","/swap",4,"ngIf"],[1,""],[1,"activity-data-wrapper"],["class","activity-data-item",4,"ngFor","ngForOf"],[1,"divider"],[1,"descripion"],[4,"ngFor","ngForOf"],["href","https://app.uniswap.org/#/swap?inputCurrency=0x6EFF556748Ee452CbDaf31bcb8c76A28651509bd&outputCurrency=0x3bdffA70f4b4E6985eED50453c7C0D4A15dcEc52","target","_blank"],["routerLink","/swap"],[1,"activity-data-item"],[1,"lable"],[4,"ngIf"],["class","value",4,"ngIf"],["mode","determinate",3,"value"],[1,"value"],[1,"Q"],[2,"display","grid","grid-template-columns","8px auto","padding-left","12px","column-gap","4px"],[2,"font-size","8px"],[1,"A"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"button",3),t.NdJ("click",function(){return n.goBack()}),t._uU(4," < back "),t.qZA(),t.TgZ(5,"h1"),t._uU(6),t.qZA(),t.YNc(7,p,2,0,"a",4),t.YNc(8,A,2,0,"a",5),t.qZA(),t.TgZ(9,"div",6),t.TgZ(10,"div",7),t.YNc(11,E,7,5,"div",8),t.qZA(),t._UZ(12,"div",9),t.TgZ(13,"p",10),t._uU(14,"Use-to-earn is an amazing and novel tokenomic paradigm aiming to greatly boost crypto-native stablecoin's user adoption in an unprecedented way. Using TiUSD will always yield higher earnings than if you use other stablecoins. TiUSD can be illustrated as interest-bearing stablecoin pegging to $1. "),t.qZA(),t.YNc(15,v,3,2,"ng-container",11),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Oqu(null==n.activityInfo?null:n.activityInfo.name),t.xp6(1),t.Q6J("ngIf","Buy TiTi in Uniswap"===(null==n.activityInfo?null:n.activityInfo.name)),t.xp6(1),t.Q6J("ngIf","TiUSD Holder"===(null==n.activityInfo?null:n.activityInfo.name)||"Buy TiUSD in TiTi-AMMs (Swap)"===(null==n.activityInfo?null:n.activityInfo.name)),t.xp6(3),t.Q6J("ngForOf",null==n.activityInfo?null:n.activityInfo.metadata),t.xp6(4),t.Q6J("ngForOf",null==n.activityInfo?null:n.activityInfo.description))},directives:[a.lW,g.O5,g.sg,w.yS,u.pW],pipes:[g.Ov,h.p],styles:[".activity-wrapper[_ngcontent-%COMP%]{padding:12px 36px 12px 12px;width:100%;min-height:calc(100vh - 200px);box-sizing:border-box}.titi-dark-theme[_nghost-%COMP%]   .divider[_ngcontent-%COMP%], .titi-dark-theme   [_nghost-%COMP%]   .divider[_ngcontent-%COMP%]{height:1px;width:100%;margin:16px 0;background:linear-gradient(90deg,rgba(255,255,255,0),#0F5F4F,rgba(255,255,255,0))}.divider[_ngcontent-%COMP%]{height:1px;width:100%;margin:16px 0;background:#dafff8}.activity-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.back-btn[_ngcontent-%COMP%]{position:absolute;left:36px;top:36px}.desc-title[_ngcontent-%COMP%]{margin-left:12px;color:#00c997}.descripion[_ngcontent-%COMP%]{padding:4px 12px;font-size:14px;word-wrap:break-word;word-break:break-word;white-space:pre-line;overflow-x:hidden;overflow-y:scroll;margin:0}.Q[_ngcontent-%COMP%]{padding:24px 12px 12px;font-size:28px;line-height:28px;word-wrap:break-word;word-break:break-word;white-space:pre-line;overflow-x:hidden;overflow-y:scroll;margin:0}.A[_ngcontent-%COMP%]{padding:0 12px 8px 0;font-size:14px;word-wrap:break-word;word-break:break-word;white-space:pre-line;overflow-x:hidden;overflow-y:scroll;margin:0}.activity-data-wrapper[_ngcontent-%COMP%]{padding:12px;width:60%;margin:0 15%}.activity-data-item[_ngcontent-%COMP%]{margin:28px 0;display:grid;font-size:18px;grid-template-columns:50% 50%;align-items:center}.activity-data-item[_ngcontent-%COMP%]   .lable[_ngcontent-%COMP%]{justify-self:start;align-self:center}.activity-data-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{justify-self:end;align-self:center;color:#2b9177}.titi-dark-theme[_nghost-%COMP%]   .value[_ngcontent-%COMP%], .titi-dark-theme   [_nghost-%COMP%]   .value[_ngcontent-%COMP%]{color:#00ffea}@media screen and (max-width: 1024px){.activity-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;box-sizing:border-box}.activity-card[_ngcontent-%COMP%]{padding:60px 12px 12px}.activity-title[_ngcontent-%COMP%]{width:100%}.activity-data-wrapper[_ngcontent-%COMP%]{width:100%;box-sizing:border-box}.back-btn[_ngcontent-%COMP%]{position:absolute;left:12px;top:36px}.activity-data-wrapper[_ngcontent-%COMP%]{padding:12px;width:100%;margin:0;box-sizing:border-box}.descripion[_ngcontent-%COMP%]{box-sizing:border-box}}"]}),i})()}];let Z=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[w.Bz.forChild(f)],w.Bz]}),i})();var y=r(63874),m=r(87841);let P=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[g.ez,Z,u.Cv,y.Ps,a.ot,m.m]]}),i})()},32681:($,R,r)=>{r.d(R,{Q:()=>O});var g=r(57959),w=r(94528),U=r(57424),x=r(32856),S=r(98538),t=r.n(S),b=r(52909),s=r(48634),u=r(5963),h=r(54004),p=r(5e3),A=r(57610),C=r(11730),M=r(65707);let O=(()=>{class _{constructor(l,T,v){this.accountService=l,this.web3Service=T,this.chainInfoService=v,this.buyTiUSDReward=0,this.buyTiUSDPersonalReward=0,this.buyTiUSDRewardRate=0,this.buyTiUSDPersonalRewardRate=0,this.holdTiUSDReward=0,this.holdTiUSDPersonalReward=0,this.holdTiUSDRewardRate=0,this.holdTiUSDPersonalRewardRate=0,this.buyTiTiReward=0,this.buyTiTiPersonalReward=0,this.buyTiTiRewardRate=0,this.buyTiTiPersonalRewardRate=0,this.totalClaimableRewards=0,this.distributedTiTiRewards=0,this.APIURL="https://api.thegraph.com/subgraphs/name/titimainnet/titi-use-to-earn",this.client=new g.f({uri:this.APIURL,cache:new w.h}),this.chainInfoService.currentChainId$.subscribe(D=>{this.setNewApi(this.chainInfoService.getChainConfig(D).use2earnApi)}),(0,u.H)(1e4,1e4).pipe((0,h.U)(()=>this.fetchUserData())).subscribe()}setNewApi(l){this.client.setLink(new U.u({uri:l}))}fetchUserData(){return Promise.all([this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["0"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["1"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["2"])]).then(([l,T,v])=>(this.currentEpochInfo={epochNum:l[0],duration:l[2],starttime:l[3],holdTiUSDReward:l[1],buyTiTiReward:v[1],buyTiUSDReward:T[1],totalRewards:b.O$.from(l[1]).add(b.O$.from(v[1])).add(b.O$.from(T[1])).toString()},this.currentEpochInfo)).then(({epochNum:l,duration:T,starttime:v,holdTiUSDReward:D,buyTiTiReward:f,buyTiUSDReward:Z})=>{const y=1e3*v,m=T/86400,P=parseFloat((0,s.formatUnits)(Z,"18")),i=parseFloat((0,s.formatUnits)(D,"18")),d=parseFloat((0,s.formatUnits)(f,"18"));return this.buyTiUSDReward=P,this.buyTiUSDRewardRate=P/m,this.holdTiUSDReward=i,this.holdTiUSDRewardRate=i/m,this.buyTiTiReward=d,this.buyTiTiRewardRate=d/m,this.fetchUserDailyData(l,y,y+1e3*T).then(({data:e})=>{function c(){let o;const I=(new Date).getTime();return o=I<y?y:I<y+24*m*3600*1e3?I:y+24*m*3600*1e3,o/1e3}this.buyTiUSDPersonalReward=0,this.holdTiUSDPersonalReward=0,this.buyTiTiPersonalReward=0,this.buyTiUSDPersonalRewardRate=0,this.holdTiUSDPersonalRewardRate=0,this.buyTiTiPersonalRewardRate=0,e.user&&e.epochUser&&(e.user.dailyUserMint.forEach(o=>{1e3*(o.dailyMint.dayStartTimestamp+28800)>=y&&1e3*(o.dailyMint.dayStartTimestamp+28800)<y+24*m*3600*1e3&&(this.buyTiUSDPersonalReward+=this.buyTiUSDRewardRate*o.dailyVolume/o.dailyMint.dailyTotalVolume)}),this.holdTiUSDPersonalReward=parseFloat((0,s.formatUnits)(new(t())(e.epochUser.rewards).add(new(t())(e.user.balance).mul(function(o){if(0===Number.parseInt(o.totalSupply))return new(t())(o.rewardPerTokenStored);const I=new(t())(c()-1*o.lastUpdateTime).mul(new(t())(D)).mul(new(t())("1000000000000000000")).div(new(t())(o.totalSupply).mul(new(t())(86400)).mul(new(t())(m)));return new(t())(o.rewardPerTokenStored).add(I)}(e.holder).sub(new(t())(e.epochUser.userRewardPerTokenPaid))).div(new(t())("10").pow(new(t())("18")))).toString(),"18")),e.user.dailyUserSwap.forEach(o=>{1e3*(o.dailySwap.dayStartTimestamp+28800)>=y&&1e3*(o.dailySwap.dayStartTimestamp+28800)<y+24*m*3600*1e3&&(this.buyTiTiPersonalReward+=this.buyTiTiRewardRate*o.dailyVolume/o.dailySwap.dailyTotalVolume)}),this.buyTiUSDPersonalRewardRate=(new Date).getTime()<y+24*m*3600*1e3&&e.dailyUserMint&&e.dailyUserMint.dailyMint.dailyTotalVolume?this.buyTiUSDRewardRate*e.dailyUserMint.dailyVolume/e.dailyUserMint.dailyMint.dailyTotalVolume:0,this.buyTiTiPersonalRewardRate=(new Date).getTime()<y+24*m*3600*1e3&&e.dailyUserSwap&&e.dailyUserSwap.dailySwap.dailyTotalVolume?this.buyTiTiRewardRate*e.dailyUserSwap.dailyVolume/e.dailyUserSwap.dailySwap.dailyTotalVolume:0,this.holdTiUSDPersonalRewardRate=(new Date).getTime()<y+24*m*3600*1e3?this.holdTiUSDRewardRate*e.user.balance/e.holder.totalSupply:0),this.distributedTiTiRewards=(1e3*c()-y)/864e5*(this.buyTiUSDRewardRate+this.holdTiUSDRewardRate+this.buyTiTiRewardRate)})})}fetchUserDailyData(l,T,v){return this.accountService.getCurrentAccountAsyn().then(f=>this.client.query({query:(0,x.Ps)("\n    query($userId: ID,$epochUserId: ID,$epochId:ID,$dayId:ID,$startDayId:ID,$endDayId:ID) {\n      epochUser(id:$epochUserId){\n        userRewardPerTokenPaid\n        rewards\n      }\n      user(id:$userId){\n        id\n        address\n        balance\n        dailyUserTransfer(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyTransfer{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserMint(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyMint{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserSwap(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailySwap{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n      }\n      holder(id:$epochId){\n        lastUpdateTime\n        rewardPerTokenStored\n        totalSupply\n      }\n      dailyUserTransfer(id:$dayId){\n        dailyVolume\n        dailyTransfer{\n          dailyTotalVolume\n        }\n      }\n      dailyUserMint(id:$dayId){\n        dailyVolume\n        dailyMint{\n          dailyTotalVolume\n        }\n      }\n      dailyUserSwap(id:$dayId){\n        dailyVolume\n        dailySwap{\n          dailyTotalVolume\n        }\n      }\n   }\n  "),variables:{userId:f.toLowerCase(),epochUserId:l+"-0-"+f.toLowerCase(),epochId:l,dayId:f.toLowerCase()+"-"+Math.floor(((new Date).getTime()-288e5)/864e5),startDayId:f.toLowerCase()+"-"+Math.floor((T-288e5)/864e5),endDayId:f.toLowerCase()+"-"+Math.floor((v-288e5)/864e5)},fetchPolicy:"network-only"}))}}return _.\u0275fac=function(l){return new(l||_)(p.LFG(A.B),p.LFG(C.Uc),p.LFG(M.Z))},_.\u0275prov=p.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);