"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[308],{57308:(A,T,a)=>{a.r(T),a.d(T,{TitiModule:()=>b});var g=a(69808),f=a(71787),u=a(17489),d=a(28321),c=a(11730),i=a(5e3),v=a(53405),m=a(74696),S=a(31657),P=a(92134),y=a(11523),w=a(75303);const C=[{path:"",component:(()=>{class n{constructor(t,e,r,l){this.graphService=t,this.echartService=e,this.web3Service=r,this.refreshService=l,this.totalStakedTiTi=0,this.totalTiTiSupply=0,this.titiDailyPrice=[0],this.TiUSDDailyPrice=[],this.option={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchTiUSDChartData(),this.fetchCurrentEpochInfo(),this.fetchTiTiTotalSupply(),this.fetchOptions()]).then(()=>this.buildOption())}buildOption(){this.option.series[0].data=this.titiDailyPrice,this.option=(0,u.cloneDeep)(this.option)}fetchOptions(){return this.echartService.fetchOption("TiTi-Price").then(t=>this.option=t)}fetchTiUSDChartData(){return this.graphService.fetchMMFSwapPairDailyData(c.wE.MAMMSwapPair).then(({data:t})=>{var e;this.TiUSDDailyPrice=Array(30).fill(null);const r=(0,d.Gq)().reverse();null===(e=t.pair)||void 0===e||e.pairDailyData.forEach(s=>{const o=r.indexOf(1e3*s.dayStartTimestamp);-1!==o&&(this.TiUSDDailyPrice[o]=s.token0Price)});let l=1;return this.TiUSDDailyPrice.forEach((s,o)=>{null==s?this.TiUSDDailyPrice[o]=l:l=s}),this.fetchUniwapPairDailyData()})}fetchUniwapPairDailyData(){return Promise.all([this.graphService.fetchUniwapPairDailyData(),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[])]).then(([{data:t},e])=>{const r=Array(30).fill(null),l=(0,d.Gq)().reverse();0===t.uniswapPair.dailyData.length?r.fill(e[1]/e[0]):t.uniswapPair.dailyData.forEach(o=>{const p=l.indexOf(1e3*o.dayStartTimestamp);-1!==p&&(r[p]=o.fund1/o.fund0)});let s="0";r.forEach((o,p)=>{null==o?r[p]=s/this.TiUSDDailyPrice[p]:(r[p]=o/this.TiUSDDailyPrice[p],s=r[p])}),this.titiDailyPrice=r})}fetchCurrentEpochInfo(){return this.web3Service.invokeContract("TiTiBackendV1","epochNum",[]).then(t=>{this.fetchTiTiStakingInfoByEpoch(t[0])})}fetchTiTiStakingInfoByEpoch(t){return this.web3Service.invokeContract("TiTiStaking","totalTiTi",[]).then(e=>{this.totalStakedTiTi=e[0]/10**18})}fetchTiTiTotalSupply(){return Promise.all([this.web3Service.invokeContract("TiTiToken","totalSupply",[]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.wE.MMFLPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.wE.LPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.il]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.Lg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.cr]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.Ew]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.xo]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.vl]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.Hg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[c.wj])]).then(([t,e,r,l,s,o,p,x,k,Z,U])=>{this.totalTiTiSupply=(t[0]-e[0]-r[0]-l[0]-s[0]-o[0]-p[0]-x[0]-k[0]-Z[0]-U[0])/10**18})}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(v.h),i.Y36(m.p),i.Y36(c.Uc),i.Y36(S.g))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-titi"]],decls:23,vars:14,consts:[[1,"titi-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","TiTi price calculated based on Uniswap and MAMM"],[1,"value"],["text","Proportion of staked TiTi in total circulation"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"h2",2),i._uU(3,"TiTi Price "),i._UZ(4,"titi-tooltip",3),i.qZA(),i.TgZ(5,"span",4),i._uU(6),i.ALo(7,"numberFormat"),i.qZA(),i.qZA(),i.TgZ(8,"div",1),i.TgZ(9,"h2",2),i._uU(10,"TiTi Circulation"),i.qZA(),i.TgZ(11,"span",4),i._uU(12),i.ALo(13,"numberFormat"),i.qZA(),i.qZA(),i.TgZ(14,"div",1),i.TgZ(15,"h2",2),i._uU(16,"Staked Ratio "),i._UZ(17,"titi-tooltip",5),i.qZA(),i.TgZ(18,"span",4),i._uU(19),i.ALo(20,"numberFormat"),i.qZA(),i.qZA(),i.TgZ(21,"div",6),i._UZ(22,"titi-chart-wrapper",7),i.qZA(),i.qZA()),2&t&&(i.xp6(6),i.hij("$",i.xi3(7,5,e.titiDailyPrice[e.titiDailyPrice.length-1],4),""),i.xp6(6),i.Oqu(i.xi3(13,8,e.totalTiTiSupply,4)),i.xp6(7),i.hij("",0===e.totalTiTiSupply?0:i.xi3(20,11,100*e.totalStakedTiTi/e.totalTiTiSupply,4),"%"),i.xp6(3),i.Q6J("option",e.option)("showTitle",!0))},directives:[P.Q,y.o],pipes:[w.p],styles:[".titi-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:calc(100vh - 280px)}@media screen and (max-width: 1024px){.titi-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px;height:auto}}"]}),n})()}];let D=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[f.Bz.forChild(C)],f.Bz]}),n})();var O=a(45922),M=a(87841);let b=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[[g.ez,D,O.F,M.m]]}),n})()}}]);