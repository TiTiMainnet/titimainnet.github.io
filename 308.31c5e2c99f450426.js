(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[308],{28321:(S,T,e)=>{"use strict";function c(){const r=(new Date).getTime(),h=[];let i=36e5*parseInt(r/36e5+"");for(let n=0;n<720;n++)h.push(i),i-=36e5;return h}function u(){const r=(new Date).getTime(),h=[];let i=864e5*parseInt(r/864e5+"");for(let n=0;n<30;n++)h.push(i),i-=864e5;return h}function m(){const r=(new Date).getTime();return 86400*parseInt(r/864e5+"")-2592e3}function a(s){return s>0?[parseInt(s/864e5+"")+"d",parseInt(s%864e5/36e5+"")+"h",parseInt(s%36e5/6e4+"")+"m",parseInt(s%6e4/1e3+"")+"s"].join(":"):[" -- d"," -- h"," -- m"," -- s"].join(":")}function t(s){let r=s;const h=r.substring(0,1),i=r.substring(1,2);if(r.length>1&&"0"===h&&"."!==i&&(r=r.substring(1,2)),"."===h&&(r=""),-1!==r.indexOf(".")){let n=r.substring(r.indexOf(".")+1);-1!==n.indexOf(".")&&(r=r.substring(0,r.indexOf(".")+n.indexOf(".")+1))}return r=r.replace(/[^\d^\.]+/g,""),r}e.d(T,{jn:()=>c,Gq:()=>u,Mv:()=>m,lR:()=>a,Y4:()=>t})},45922:(S,T,e)=>{"use strict";e.d(T,{F:()=>a});var c=e(69808),u=e(48966),m=e(87841),o=e(5e3);let a=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[c.ez,u.Is,m.m]]}),t})()},92134:(S,T,e)=>{"use strict";e.d(T,{Q:()=>o});var c=e(5e3),u=e(87238),m=e(63874);let o=(()=>{class a{constructor(){this.color="warn",this.text="",this.position="after"}ngOnInit(){}}return a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=c.Xpm({type:a,selectors:[["titi-tooltip"]],inputs:{color:"color",text:"text",position:"position"},decls:4,vars:4,consts:[["matTooltipHideDelay","200",3,"matTooltip","matTooltipPosition","matTooltipClass"],["tooltip","matTooltip"],[2,"font-size","18px","line-height","24px","display","inline","vertical-align","middle",3,"color"]],template:function(y,s){1&y&&(c.TgZ(0,"span",0,1),c.TgZ(2,"mat-icon",2),c._uU(3," help_outline "),c.qZA(),c.qZA()),2&y&&(c.Q6J("matTooltip",s.text)("matTooltipPosition",s.position)("matTooltipClass","titi-tooltip-text"),c.xp6(2),c.Q6J("color",s.color))},directives:[u.gM,m.Hw],styles:[""]}),a})()},57308:(S,T,e)=>{"use strict";e.r(T),e.d(T,{TitiModule:()=>A});var c=e(69808),u=e(71787),m=e(17489),o=e(28321),a=e(11730),t=e(5e3),y=e(65707),s=e(53405),r=e(74696),h=e(31657),i=e(92134),n=e(47423),M=e(11523),C=e(75303);const O=[{path:"",component:(()=>{class p{constructor(l,d,f,D,v){this.chainInfoService=l,this.graphService=d,this.echartService=f,this.web3Service=D,this.refreshService=v,this.totalStakedTiTi=0,this.totalTiTiSupply=0,this.titiDailyPrice=[0],this.TiUSDDailyPrice=[],this.option={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchTiUSDChartData(),this.fetchCurrentEpochInfo(),this.fetchTiTiTotalSupply(),this.fetchOptions()]).then(()=>this.buildOption())}buildOption(){this.option.series[0].data=this.titiDailyPrice,this.option=(0,m.cloneDeep)(this.option)}fetchOptions(){return this.echartService.fetchOption("TiTi-Price").then(l=>this.option=l)}fetchTiUSDChartData(){return this.graphService.fetchMMFSwapPairDailyData(this.chainInfoService.getChainConfig().contractAddressMap.MAMMSwapPair).then(({data:l})=>{var d;this.TiUSDDailyPrice=Array(30).fill(null);const f=(0,o.Gq)().reverse();null===(d=l.pair)||void 0===d||d.pairDailyData.forEach(v=>{const g=f.indexOf(1e3*v.dayStartTimestamp);-1!==g&&(this.TiUSDDailyPrice[g]=v.token0Price)});let D=1;return this.TiUSDDailyPrice.forEach((v,g)=>{null==v?this.TiUSDDailyPrice[g]=D:D=v}),this.fetchUniwapPairDailyData()})}fetchUniwapPairDailyData(){return Promise.all([this.graphService.fetchUniwapPairDailyData(),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[])]).then(([{data:l},d])=>{const f=Array(30).fill(null),D=(0,o.Gq)().reverse();0===l.uniswapPair.dailyData.length?f.fill(d[1]/d[0]):l.uniswapPair.dailyData.forEach(g=>{const P=D.indexOf(1e3*g.dayStartTimestamp);-1!==P&&(f[P]=g.fund1/g.fund0)});let v="0";f.forEach((g,P)=>{null==g?f[P]=v*this.TiUSDDailyPrice[P]:(f[P]=g*this.TiUSDDailyPrice[P],v=f[P])}),this.titiDailyPrice=f})}fetchCurrentEpochInfo(){return this.web3Service.invokeContract("TiTiBackendV1","epochNum",[]).then(l=>{this.fetchTiTiStakingInfoByEpoch(l[0])})}fetchTiTiStakingInfoByEpoch(l){return this.web3Service.invokeContract("TiTiStaking","totalTiTi",[]).then(d=>{this.totalStakedTiTi=d[0]/10**18})}fetchTiTiTotalSupply(){return Promise.all([this.web3Service.invokeContract("TiTiToken","totalSupply",[]),this.web3Service.invokeContract("TiTiToken","balanceOf",[this.chainInfoService.getChainConfig().contractAddressMap.MMFLPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[this.chainInfoService.getChainConfig().contractAddressMap.LPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.il]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.Lg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.cr]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.Ew]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.xo]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.vl]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.Hg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[a.wj])]).then(([l,d,f,D,v,g,P,_,U,b,$])=>{this.totalTiTiSupply=(l[0]-d[0]-f[0]-D[0]-v[0]-g[0]-P[0]-_[0]-U[0]-b[0]-$[0])/10**18})}}return p.\u0275fac=function(l){return new(l||p)(t.Y36(y.Z),t.Y36(s.h),t.Y36(r.p),t.Y36(a.Uc),t.Y36(h.g))},p.\u0275cmp=t.Xpm({type:p,selectors:[["app-titi"]],decls:26,vars:14,consts:[[1,"titi-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","TiTi price calculated based on Uniswap and MAMM"],[1,"value"],["href","https://app.uniswap.org/#/swap?inputCurrency=0x6EFF556748Ee452CbDaf31bcb8c76A28651509bd&outputCurrency=0x3bdffA70f4b4E6985eED50453c7C0D4A15dcEc52","target","_blank",1,"action-btn"],["mat-raised-button","","color","primary",2,"width","100%"],["text","Proportion of staked TiTi in total circulation"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"]],template:function(l,d){1&l&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiTi Price "),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.TgZ(8,"a",5),t.TgZ(9,"button",6),t._uU(10,"BUY"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",1),t.TgZ(12,"h2",2),t._uU(13,"TiTi Circulation"),t.qZA(),t.TgZ(14,"span",4),t._uU(15),t.ALo(16,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(17,"div",1),t.TgZ(18,"h2",2),t._uU(19,"Staked Ratio "),t._UZ(20,"titi-tooltip",7),t.qZA(),t.TgZ(21,"span",4),t._uU(22),t.ALo(23,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(24,"div",8),t._UZ(25,"titi-chart-wrapper",9),t.qZA(),t.qZA()),2&l&&(t.xp6(6),t.hij("$",t.xi3(7,5,d.titiDailyPrice[d.titiDailyPrice.length-1],4),""),t.xp6(9),t.Oqu(t.xi3(16,8,d.totalTiTiSupply,4)),t.xp6(7),t.hij("",0===d.totalTiTiSupply?0:t.xi3(23,11,100*d.totalStakedTiTi/d.totalTiTiSupply,4),"%"),t.xp6(3),t.Q6J("option",d.option)("showTitle",!0))},directives:[i.Q,n.lW,M.o],pipes:[C.p],styles:[".titi-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px;line-height:36px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:calc(100vh - 280px)}@media screen and (max-width: 1024px){.titi-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px;height:auto}}"]}),p})()}];let E=(()=>{class p{}return p.\u0275fac=function(l){return new(l||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[[u.Bz.forChild(O)],u.Bz]}),p})();var I=e(45922),k=e(87841);let A=(()=>{class p{}return p.\u0275fac=function(l){return new(l||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[[c.ez,E,I.F,k.m,n.ot]]}),p})()},74696:(S,T,e)=>{"use strict";e.d(T,{p:()=>o});var c=e(17489),m=e(5e3);let o=(()=>{class a{constructor(){}fetchOption(y){return e(45744)(`./${y}`).then(s=>(0,c.cloneDeep)(s.default))}}return a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=m.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},53405:(S,T,e)=>{"use strict";e.d(T,{h:()=>s});var c=e(57959),u=e(94528),m=e(57424),o=e(32856),a=e(28321),t=e(5e3),y=e(65707);let s=(()=>{class r{constructor(i){this.chainInfoService=i,this.APIURL="https://api.thegraph.com/subgraphs/name/titimainnet/titi-mainnet",this.client=new c.f({uri:this.APIURL,cache:new u.h}),this.chainInfoService.currentChainId$.subscribe(n=>{this.setNewApi(this.chainInfoService.getChainConfig(n).subgraphApi)})}setNewApi(i){this.client.setLink(new m.u({uri:i}))}fetchMMFSwapPairHourData(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$time:Int) {\n      pair(id:$id) {\n        id\n        pairHourData(where: {hourStartTimestamp_gt: $time},orderBy: hourStartTimestamp,orderDirection: desc)  {\n          id\n          hourStartTimestamp\n          fund0\n          fund1\n          token0Price\n          token1Price\n        }\n     }\n   }\n  "),variables:{id:i.toLowerCase(),time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchMMFSwapPairDailyData(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$time:Int) {\n      pair(id:$id) {\n        id\n        pairDailyData(where: {dayStartTimestamp_gt: $time},orderBy: dayStartTimestamp,orderDirection: desc)  {\n          id\n          dayStartTimestamp\n          fund0\n          fund1\n          mmfFund0\n          mmfFund1\n          token0Price\n          token1Price\n        }\n     }\n   }\n  "),variables:{id:i.toLowerCase(),time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchAllSwapPairDailyData(){return this.client.query({query:(0,o.Ps)("\n    query($time:Int) {\n      pairs(orderBy: id,orderDirection: desc) {\n        id\n        fund0\n        fund1\n        prv\n        token1{\n          symbol\n          decimals\n        }\n        token0Twap\n        pairDailyData(where: {dayStartTimestamp_gt: $time},orderBy: dayStartTimestamp,orderDirection: desc)  {\n          id\n          dayStartTimestamp\n          fund0\n          fund1\n          token0Price\n          token1Price\n          token0Twap\n          prv\n        }\n        pairHourData(where: {hourStartTimestamp_gt: $time},orderBy: hourStartTimestamp,orderDirection: desc)  {\n          id\n          hourStartTimestamp\n          fund0\n          fund1\n          token0Price\n          token1Price\n          token0Twap\n          prv\n        }\n     }\n   }\n  "),variables:{time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchUniwapPairDailyData(){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$time:Int) {\n      uniswapPair(id:$id) {\n        fund0\n        fund1\n        liquidity\n        dailyData(where: {dayStartTimestamp_gt: $time},orderBy: dayStartTimestamp,orderDirection: desc)  {\n          id\n          dayStartTimestamp\n          fund0\n          fund1\n          liquidity\n        }\n     }\n   }\n  "),variables:{id:this.chainInfoService.getChainConfig().contractAddressMap.UniswapV2Pair.toLowerCase(),time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchDailyLPTokenStakedValue(){return this.client.query({query:(0,o.Ps)("\n    query($time:Int) \n    {\n        dailyLPStakings(where: {dayTimestamp_gt: $time},orderBy: dayTimestamp,orderDirection: desc)  {\n          id\n          dayTimestamp\n          stakedValue\n        }\n   }\n  "),variables:{id:this.chainInfoService.getChainConfig().contractAddressMap.UniswapV2Pair.toLowerCase(),time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchMMFRewardDailyData(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$time:Int) {\n      pair(id:$id) {\n        id\n        mmfRewardDailyData(where: {dayStartTimestamp_gt: $time},orderBy: dayStartTimestamp,orderDirection: desc)  {\n          id\n          dayStartTimestamp\n          mmfReward\n        }\n     }\n   }\n  "),variables:{id:i.toLowerCase(),time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchTodayMMFRewardData(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$pairId:ID) {\n      mmfrewardDailyData(id:$id) {\n        id\n        dayStartTimestamp\n        mmfReward\n      }\n      pair(id:$pairId) {\n        id\n        fund0\n        fund1\n      }\n      pairDailyData(id:$id) {\n        id\n        mmfFund1\n      }\n   }\n  "),variables:{id:i.toLowerCase()+"-"+Number.parseInt((new Date).getTime()/864e5+""),pairId:i.toLowerCase()},fetchPolicy:"network-only"})}fetchMMFRewardHourDataIn24H(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$time: Int) {\n      pair(id:$id) {\n        id\n        mmfRewardHourData(where: {hourStartTimestamp_gt: $time},orderBy: hourStartTimestamp,orderDirection: desc)  {\n          id\n          hourStartTimestamp\n          mmfReward\n        }\n     }\n   }\n  "),variables:{id:i.toLowerCase(),time:Number.parseInt((new Date).getTime()/1e3-86400+"")},fetchPolicy:"network-only"})}fetchTiTiStakingDailyData(){return this.client.query({query:(0,o.Ps)("\n    query($time:Int) {\n      tiTiStakingEpochDailyDatas(where: {dayStartTimestamp_gt: $time},orderBy: dayStartTimestamp,orderDirection: desc)  {\n        id\n        dayStartTimestamp\n        tvl\n        apy\n        epoch{\n          id\n        }\n      }\n   }\n  "),variables:{time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchEachEpochTotalReward(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID) {\n      tiTiStakingEpoches(where: {id_lt: $id}) {\n        tvl\n        totalReward\n     }\n   }\n  "),variables:{id:i},fetchPolicy:"network-only"})}fetchVaultFund(i){return this.client.query({query:(0,o.Ps)("\n    query($id: ID,$time:Int) {\n      fundVault(id:$id) {\n        id\n        address\n        dailyBalance(where: {dayStartTimestamp_gt: $time},orderBy: dayStartTimestamp,orderDirection: desc)  {\n          id\n          dayStartTimestamp\n          balance\n          token{\n            symbol\n            decimals\n          }\n        }\n     }\n   }\n  "),variables:{id:i,time:(0,a.Mv)()},fetchPolicy:"network-only"})}fetchLastReOrdersData(){return this.client.query({query:(0,o.Ps)("\n    query {\n      reOrders(first: 1, orderBy: lastReordersTime, orderDirection: desc) {\n        id\n        lastReordersTime\n        reordersCondition\n        pavAmount\n      }\n   }\n  "),variables:{},fetchPolicy:"network-only"})}fetchStakingEpochOverview(i){return this.client.query({query:(0,o.Ps)("\n    query ($address:String!){\n      lpstakingEpochOverview(id:$address){\n        currentEpochNum\n      }\n   }\n  "),variables:{address:i.toLowerCase()},fetchPolicy:"network-only"})}fetchHistoricalMMFStakingEpoch(i){return this.client.query({query:(0,o.Ps)("\n    query ($epochNum:Int){\n      mmfstakingEpoches(where:{epochNum_lt:$epochNum}){\n        epochNum\n        startTimestamp\n        periodFinish\n        totalReward\n      }\n   }\n  "),variables:{epochNum:1*i},fetchPolicy:"network-only"})}fetchHistoricalLPStakingEpoch(i){return this.client.query({query:(0,o.Ps)("\n    query ($epochNum:Int){\n      lpstakingEpoches(where:{epochNum_lt:$epochNum}){\n        epochNum\n        startTimestamp\n        periodFinish\n        totalReward\n      }\n   }\n  "),variables:{epochNum:1*i},fetchPolicy:"network-only"})}fetchTiTiStakingUserRank(i,n){return this.client.query({query:(0,o.Ps)("\n    query($rank: Int,$blacklist: [String]) {\n      tiTiUserStakings(where:{id_not_in:$blacklist},orderBy: share, orderDirection: desc,first:$rank) {\n        id\n        share\n      }\n      tiTiStakings(first: 1){\n        totalAmount\n        totalShare\n      }\n   }\n  "),variables:{rank:i,blacklist:n},fetchPolicy:"network-only"})}fetchTiUSDCirculation(){const i=`\n    query {\n      tiUSD(id:"${this.chainInfoService.getChainConfig().contractAddressMap.TiUSD.toLowerCase()}") {\n        id\n        tiusdCirculation\n      }\n   }\n  `;return this.client.query({query:(0,o.Ps)(i),variables:{},fetchPolicy:"network-only"})}}return r.\u0275fac=function(i){return new(i||r)(t.LFG(y.Z))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},45744:(S,T,e)=>{var c={"./LPMining-APY":[62790,45,790],"./LPMining-APY.ts":[62790,45,790],"./LPMining-Liquidity":[57238,45,238],"./LPMining-Liquidity.ts":[57238,45,238],"./MMF-APY":[95737,45,737],"./MMF-APY.ts":[95737,45,737],"./RainydayFund-Bar":[35201,201],"./RainydayFund-Bar.ts":[35201,201],"./RainydayFund-Pie":[16655,655],"./RainydayFund-Pie.ts":[16655,655],"./TiTi-Price":[73107,45,107],"./TiTi-Price.ts":[73107,45,107],"./TiTiStaking-APY":[33186,45,186],"./TiTiStaking-APY.ts":[33186,45,186],"./TiTiStaking-Ratio":[53297,45,297],"./TiTiStaking-Ratio.ts":[53297,45,297],"./TiUSD-Reserve-Bar":[78817,817],"./TiUSD-Reserve-Bar.ts":[78817,817],"./TiUSD-Reserve-Pie":[83706,706],"./TiUSD-Reserve-Pie.ts":[83706,706],"./TiUSD-TWAP":[34917,917],"./TiUSD-TWAP.ts":[34917,917],"./TiUSDPrice":[53487,45,487],"./TiUSDPrice.ts":[53487,45,487]};function u(m){if(!e.o(c,m))return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+m+"'");throw t.code="MODULE_NOT_FOUND",t});var o=c[m],a=o[0];return Promise.all(o.slice(1).map(e.e)).then(()=>e(a))}u.keys=()=>Object.keys(c),u.id=45744,S.exports=u}}]);