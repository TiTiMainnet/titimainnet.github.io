"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[419],{82419:(W,I,a)=>{a.r(I),a.d(I,{SwapModule:()=>K});var b=a(69808),L=a(93075),P=a(71787),S=a(11730),h=a(98538),p=a.n(h),y=a(28321),$=a(17489),V=a(48634),t=a(5e3),R=a(57610),_=a(32681),C=a(63874),x=a(22313),f=a(48966),E=a(53405),u=a(74696),m=a(31657),g=a(67322),v=a(77531),T=a(47423),k=a(92134),l=a(4834),d=a(26688),F=a(87238),B=a(11523),O=a(75303);function o(n,w){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSwap()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("disabled",!e.outputValue||0>=e.outputValue||e.inputValue>(e.isBuyingTiUSD?e.token1Balance:e.token0Balance)||e.isLoading),t.xp6(1),t.Oqu(e.isLoading?"waiting...":"Swap")}}function j(n,w){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw().onApprove()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("disabled",e.isLoading),t.xp6(1),t.Oqu(e.isLoading?"waiting...":"Approve")}}const Z=[{token0:"TiUSD",token1:"USDC"}];let r=(()=>{class n{constructor(e,i,s,c,M,D,A,Q,N,X){this.accountService=e,this.router=i,this.use2earnService=s,this.web3Service=D,this.dialog=A,this.graphService=Q,this.echartService=N,this.refreshService=X,this.isBuyingTiUSD=!0,this.isLoading=!0,this.isApproved=!1,this.token0Balance=0,this.token1Balance=0,this.swapPairList=Z,this.currentSwapPair=Z[0],this.inputValue=0,this.outputValue=0,this.fund0=0,this.fund1=0,this.decimal0=18,this.decimal1=6,this.priceImpact="0.00%",this.MMFfund=0,this.lastFund0=0,this.lastFund1=0,this.chartData=[],this.option={},c.addSvgIconLiteral("USDC",M.bypassSecurityTrustHtml(U)),c.addSvgIconLiteral("TiUSD",M.bypassSecurityTrustHtml(J))}get prv(){const e=Math.abs(this.lastFund1-this.MMFfund)+(this.lastFund0-this.fund0);return e>0?e:0}ngOnInit(){this.fetchApproveInfo(),this.initData();const e=this.refreshService.registerFunction(()=>this.initData()),i=this.refreshService.registerFunctionWithoutInterval(()=>this.fetchApproveInfo());this.unregister=()=>{e(),i()}}ngOnDestroy(){this.unregister()}initData(){this.fetchBalanceOfToken0(),this.fetchBalanceOfToken1(),this.fetchPoolInfo(),this.fetchMMFFund(),this.fetchLastfund0(),this.fetchLastfund1(),this.fetchOption().then(()=>this.fetchTiUSDChartData())}buildOption(){this.option.series[0].data=this.chartData,this.option=(0,$.cloneDeep)(this.option)}calcPriceImpact(e,i){if(e>0&&i>0){const s=this.fund1/this.fund0;this.priceImpact=(100*Math.abs(s-e/i)/s).toFixed(2)+"%"}}onInputValueChange(e){try{this.inputValue=parseFloat(e.target.value)}catch(M){this.inputValue=0}const i=997*this.inputValue;this.outputValue=parseFloat((i*(this.isBuyingTiUSD?this.fund0:this.fund1)/(1e3*(this.isBuyingTiUSD?this.fund1:this.fund0)+i)).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue)}onOutputValueChange(e){try{this.outputValue=parseFloat(e.target.value)}catch(i){this.outputValue=0}this.inputValue=parseFloat((((this.isBuyingTiUSD?this.fund0:this.fund1)*(this.isBuyingTiUSD?this.fund1:this.fund0)*1e3/((this.isBuyingTiUSD?this.fund0:this.fund1)-this.outputValue)-1e3*(this.isBuyingTiUSD?this.fund1:this.fund0))/997).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue)}onChangeSwapType(){this.isBuyingTiUSD=!this.isBuyingTiUSD,this.inputValue=this.outputValue;const e=997*this.inputValue;this.outputValue=parseFloat((e*(this.isBuyingTiUSD?this.fund0:this.fund1)/(1e3*(this.isBuyingTiUSD?this.fund1:this.fund0)+e)).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue),this.fetchApproveInfo()}fetchApproveInfo(){this.isLoading=!0,this.accountService.getCurrentAccountAsyn().then(e=>Promise.all([this.web3Service.invokeContract(this.isBuyingTiUSD?"USDC":"TiUSD","allowance",[e,S.wE.MAMMSwapPair]),this.web3Service.invokeContract(this.isBuyingTiUSD?"USDC":"TiUSD","balanceOf",[e])]).then(([i,s])=>{"0"!==i[0]&&new(p())(i[0]).gte(new(p())(s[0]))?(this.isApproved=!0,this.isLoading=!1):(this.isApproved=!1,this.isLoading=!1)}))}onApprove(){this.isLoading=!0,this.web3Service.invokeContract(this.isBuyingTiUSD?"USDC":"TiUSD","approve",[S.wE.MAMMSwapPair,S.fV]).then(e=>{e.status?(this.isApproved=!0,this.isLoading=!1):(this.isApproved=!1,this.isLoading=!1)},e=>{this.isApproved=!1,this.isLoading=!1})}fetchOption(){return this.echartService.fetchOption("TiUSDPrice").then(e=>this.option=e)}fetchBalanceOfToken0(){this.accountService.getCurrentAccountAsyn().then(e=>this.web3Service.invokeContract(this.currentSwapPair.token0,"balanceOf",[e]).then(i=>{this.token0Balance=parseFloat(new(p())(i[0]).div(new(p())("10").pow(new(p())(this.decimal0-4))).toString())/1e4}))}fetchBalanceOfToken1(){this.accountService.getCurrentAccountAsyn().then(e=>this.web3Service.invokeContract(this.currentSwapPair.token1,"balanceOf",[e]).then(i=>{this.token1Balance=parseFloat(new(p())(i[0]).div(new(p())("10").pow(new(p())(this.decimal1-4))).toString())/1e4}))}fetchPoolInfo(){this.web3Service.invokeContract("MAMMSwapPair","getDepth",[]).then(e=>{this.fund0=e[0]/10**this.decimal0,this.fund1=e[1]/10**this.decimal1})}fetchMMFFund(){this.web3Service.invokeContract("MAMMSwapPair","getMMFFunds",[]).then(e=>{this.MMFfund=e[1]/10**this.decimal1})}fetchLastfund0(){this.web3Service.invokeContract("ReOrdersController","lastFund0",[]).then(e=>{this.lastFund0=e[0]/10**this.decimal0})}fetchLastfund1(){this.web3Service.invokeContract("ReOrdersController","lastFund1",[]).then(e=>{this.lastFund1=e[0]/10**this.decimal1})}fetchTiUSDChartData(){this.graphService.fetchMMFSwapPairHourData(S.wE.MAMMSwapPair).then(({data:e})=>{var i,s;this.chartData=Array(720).fill(null);const c=(0,y.jn)().reverse();null===(s=null===(i=e.pair)||void 0===i?void 0:i.pairHourData)||void 0===s||s.forEach(D=>{const A=c.indexOf(1e3*D.hourStartTimestamp);-1!==A&&(this.chartData[A]=parseFloat(D.token0Price).toFixed(4))});let M=1;this.chartData.forEach((D,A)=>{null==D?this.chartData[A]=M:M=D}),this.buildOption()})}onSwap(){if(this.isLoading=!0,0!==this.outputValue)if(this.isBuyingTiUSD){const e=(0,V.parseUnits)(this.inputValue+"",this.decimal1);this.web3Service.invokeContract("MAMMSwapPair","mint",[e.toString()]).then(i=>{this.isLoading=!1},i=>{this.isLoading=!1})}else{const e=(0,V.parseUnits)(this.inputValue+"",this.decimal0);this.web3Service.invokeContract("MAMMSwapPair","redeem",[e.toString()]).then(i=>{this.isLoading=!1},i=>{this.isLoading=!1})}}goToUser2EarnPage(){this.router.navigateByUrl("/use2earn")}maxSwapInputValue(){const e=Math.pow(10,4);this.inputValue=parseFloat((Math.floor((this.isBuyingTiUSD?this.token1Balance:this.token0Balance)*e)/e).toFixed(4));const i=997*this.inputValue;this.outputValue=parseFloat((i*(this.isBuyingTiUSD?this.fund0:this.fund1)/(1e3*(this.isBuyingTiUSD?this.fund1:this.fund0)+i)).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(R.B),t.Y36(P.F0),t.Y36(_.Q),t.Y36(C.jv),t.Y36(x.H7),t.Y36(S.Uc),t.Y36(f.uw),t.Y36(E.h),t.Y36(u.p),t.Y36(m.g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-swap"]],decls:94,vars:45,consts:[[1,"swap-wrapper"],[1,"swap-card","mat-elevation-z4"],[2,"grid-column-start","span 3","justify-self","center"],["appearance","outline",1,"swap-input"],["type","text","matInput","","type","number",2,"height","24px","font-size","24px",3,"value","change"],["matPrefix","",2,"padding-right","12px",3,"svgIcon"],["matSuffix",""],["mat-flat-button","",2,"margin-bottom","12px","background-color","transparent","color","#2DD6B5","font-size","18px",3,"click"],[2,"color","rgba(120, 120, 120, 0.7)","font-size","18px"],["mat-icon-button","","color","primary",2,"justify-self","center",3,"click"],["appearance","outline",1,"swap-input",2,"min-height","91px"],[2,"justify-self","start"],[2,"justify-self","end"],["text","Slippage against Transaction Volume."],["routerLink","/use2earn",2,"justify-self","end"],["mat-raised-button","","class","swap-btn","color","primary",3,"disabled","click",4,"ngIf"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[2,"justify-self","center"],["matTooltip","The liquidity depth in current swap pool.","matTooltipPosition","above","matTooltipHideDelay","200",3,"matTooltipClass"],[2,"justify-self","end","grid-column-start","2","grid-column-end","4"],["matTooltip","The USDC liquidity in this pool are provided partly by PRV, and partly by MMF.","matTooltipPosition","above","matTooltipHideDelay","200",3,"matTooltipClass"],["text","Protocol Reserve Value, referring to the aggregated value of the Reserve Assets backing circulating TiUSDs."],["text","The USDC liquidity provided by LPs through Market Maker Fund."],[1,"pool-chart",2,"width","100%","height","100%"],[2,"width","100%","height","100%",3,"option"],["mat-raised-button","","color","primary",1,"swap-btn",3,"disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3),t.qZA(),t.TgZ(4,"mat-form-field",3),t.TgZ(5,"mat-label"),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.TgZ(8,"input",4),t.NdJ("change",function(c){return i.onInputValueChange(c)}),t.qZA(),t._UZ(9,"mat-icon",5),t.TgZ(10,"div",6),t.TgZ(11,"button",7),t.NdJ("click",function(){return i.maxSwapInputValue()}),t._uU(12,"MAX"),t.qZA(),t.TgZ(13,"span",8),t._uU(14),t.qZA(),t.qZA(),t.qZA(),t._UZ(15,"div"),t.TgZ(16,"button",9),t.NdJ("click",function(){return i.onChangeSwapType()}),t.TgZ(17,"mat-icon"),t._uU(18,"arrow_downward"),t.qZA(),t.qZA(),t._UZ(19,"div"),t.TgZ(20,"mat-form-field",10),t.TgZ(21,"mat-label"),t._uU(22),t.ALo(23,"numberFormat"),t.qZA(),t.TgZ(24,"input",4),t.NdJ("change",function(c){return i.onOutputValueChange(c)}),t.qZA(),t._UZ(25,"mat-icon",5),t.TgZ(26,"div",6),t.TgZ(27,"span",8),t._uU(28),t.qZA(),t.qZA(),t.qZA(),t.TgZ(29,"span",11),t._uU(30,"Current Price:"),t.qZA(),t._UZ(31,"div"),t.TgZ(32,"span",12),t._uU(33),t.ALo(34,"numberFormat"),t.qZA(),t.TgZ(35,"span",11),t._uU(36,"Price Impact"),t._UZ(37,"titi-tooltip",13),t._uU(38,":"),t.qZA(),t._UZ(39,"div"),t.TgZ(40,"span",12),t._uU(41),t.qZA(),t.TgZ(42,"span",11),t._uU(43,"Current Epoch Rewards:"),t.qZA(),t._UZ(44,"div"),t.TgZ(45,"a",14),t._uU(46),t.ALo(47,"numberFormat"),t.qZA(),t.YNc(48,o,2,2,"button",15),t.YNc(49,j,2,2,"button",15),t.qZA(),t.TgZ(50,"div",16),t.TgZ(51,"h2",17),t._uU(52,"Pool Info"),t.qZA(),t._UZ(53,"mat-divider"),t.TgZ(54,"mat-chip-list",18),t.TgZ(55,"mat-chip",19),t._uU(56,"Liquidity "),t.qZA(),t.qZA(),t._UZ(57,"mat-divider"),t.TgZ(58,"span",11),t._uU(59,"TiUSD:"),t.qZA(),t.TgZ(60,"span",20),t._uU(61),t.ALo(62,"numberFormat"),t.qZA(),t.TgZ(63,"span",11),t._uU(64,"USDC:"),t.qZA(),t.TgZ(65,"span",20),t._uU(66),t.ALo(67,"numberFormat"),t.qZA(),t._UZ(68,"mat-divider"),t.TgZ(69,"mat-chip-list",18),t.TgZ(70,"mat-chip",21),t._uU(71,"Composition "),t.qZA(),t.qZA(),t._UZ(72,"mat-divider"),t.TgZ(73,"span",11),t._uU(74,"PRV"),t._UZ(75,"titi-tooltip",22),t._uU(76,":"),t.qZA(),t.TgZ(77,"span",20),t._uU(78),t.ALo(79,"numberFormat"),t.qZA(),t.TgZ(80,"span",11),t._uU(81,"MMF"),t._UZ(82,"titi-tooltip",23),t._uU(83,":"),t.qZA(),t.TgZ(84,"span",20),t._uU(85),t.ALo(86,"numberFormat"),t.qZA(),t._UZ(87,"mat-divider"),t.TgZ(88,"mat-chip-list",18),t.TgZ(89,"mat-chip"),t._uU(90,"TiUSD Price"),t.qZA(),t.qZA(),t._UZ(91,"mat-divider"),t.TgZ(92,"div",24),t._UZ(93,"titi-chart-wrapper",25),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.hij(" ",i.isBuyingTiUSD?i.currentSwapPair.token1+" \u2192 "+i.currentSwapPair.token0:i.currentSwapPair.token0+" \u2192 "+i.currentSwapPair.token1," "),t.xp6(3),t.hij("Input - balance:",t.xi3(7,21,i.isBuyingTiUSD?i.token1Balance:i.token0Balance,4),""),t.xp6(2),t.Q6J("value",i.inputValue),t.xp6(1),t.Q6J("svgIcon",i.isBuyingTiUSD?i.currentSwapPair.token1:i.currentSwapPair.token0),t.xp6(5),t.Oqu(i.isBuyingTiUSD?i.currentSwapPair.token1:i.currentSwapPair.token0),t.xp6(8),t.hij("Output - balance:",t.xi3(23,24,i.isBuyingTiUSD?i.token0Balance:i.token1Balance,4),""),t.xp6(2),t.Q6J("value",i.outputValue),t.xp6(1),t.Q6J("svgIcon",i.isBuyingTiUSD?i.currentSwapPair.token0:i.currentSwapPair.token1),t.xp6(3),t.Oqu(i.isBuyingTiUSD?i.currentSwapPair.token0:i.currentSwapPair.token1),t.xp6(5),t.hij("$",t.xi3(34,27,i.fund1/i.fund0||0,4),""),t.xp6(8),t.Oqu(i.priceImpact),t.xp6(5),t.hij("",t.xi3(47,30,i.use2earnService.buyTiUSDReward,4)," TiTi"),t.xp6(2),t.Q6J("ngIf",i.isApproved),t.xp6(1),t.Q6J("ngIf",!i.isApproved),t.xp6(6),t.Q6J("matTooltipClass","titi-tooltip-text"),t.xp6(6),t.Oqu(t.xi3(62,33,i.fund0,4)),t.xp6(5),t.Oqu(t.xi3(67,36,i.fund1,4)),t.xp6(4),t.Q6J("matTooltipClass","titi-tooltip-text"),t.xp6(8),t.hij("",t.xi3(79,39,i.prv,4)," USDC"),t.xp6(7),t.hij("",t.xi3(86,42,i.MMFfund,4)," USDC"),t.xp6(8),t.Q6J("option",i.option))},directives:[g.KE,g.hX,v.Nt,C.Hw,g.qo,g.R9,T.lW,k.Q,P.yS,b.O5,l.d,d.qn,d.HS,F.gM,B.o],pipes:[O.p],styles:[".swap-wrapper[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:16fr 8fr 1fr;grid-column-gap:48px;column-gap:48px}.swap-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;display:grid;grid-template-columns:1fr 1fr 1fr;grid-row-gap:16px;row-gap:16px;align-items:center}.swap-input[_ngcontent-%COMP%], .swap-btn[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4}.pool-info-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;display:grid;grid-template-columns:1fr 1fr 1fr;grid-row-gap:16px;row-gap:16px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4;justify-self:center}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4;justify-self:center;width:100%;height:100%}  .mat-form-field-flex{min-height:68px}@media screen and (max-width: 1024px){.swap-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;margin:0;display:grid;grid-template-columns:1fr;grid-row-gap:12px;row-gap:12px}.swap-card[_ngcontent-%COMP%]{width:100%}}"]}),n})();const U='<svg t="1640244631175" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2048" width="24" height="24"><path d="M513.896296 986.074074c263.888593 0 477.866667-213.978074 477.866667-477.866667s-213.978074-477.866667-477.866667-477.866666-477.866667 213.978074-477.866666 477.866666 213.978074 477.866667 477.866666 477.866667z" fill="#1296db" p-id="2049"></path><path d="M644.892444 584.210963c0-69.783704-42.477037-93.297778-124.54874-104.523852-60.529778-8.798815-72.286815-22.983111-72.286815-51.275852 0-26.851556 20.48-45.89037 60.074667-45.89037 35.802074 0 56.357926 12.515556 64.853333 41.263407 1.896296 6.447407 7.661037 10.998519 14.336 10.998519h31.402667c8.722963 0 15.54963-8.040296 13.729185-16.611556-9.936593-45.511111-40.580741-72.817778-88.670815-81.389037v-47.559111c0-8.267852-6.674963-14.942815-14.942815-14.942815h-29.88563c-8.267852 0-14.942815 6.674963-14.942814 14.942815v46.26963c-59.240296 8.419556-97.46963 47.786667-97.46963 98.379852 0 65.460148 39.518815 90.794667 123.031704 102.02074 56.661333 9.253926 72.741926 21.466074 72.741926 53.703111s-27.382519 53.703111-65.91526 53.703112c-52.110222 0-69.328593-22.831407-75.624296-52.337778-1.517037-6.97837-7.509333-12.136296-14.639407-12.136297h-34.057482c-8.571259 0-15.322074 7.736889-13.805037 16.156445 8.647111 49.682963 40.580741 86.167704 105.737482 95.04237v47.179852c0 8.267852 6.674963 14.942815 14.942814 14.942815h29.88563c8.267852 0 14.942815-6.674963 14.942815-14.942815v-47.179852c61.667556-9.784889 101.110519-52.717037 101.110518-105.813333z" fill="#FFFFFF" p-id="2050"></path><path d="M411.496296 793.713778c-114.384593-41.870222-196.228741-151.855407-196.22874-280.576 0-128.720593 81.844148-238.629926 196.22874-280.576 7.130074-2.578963 12.818963-11.226074 12.818963-18.811259v-27.83763c0-11.301926-8.798815-17.673481-19.569778-14.260148C260.171852 217.92237 155.496296 353.317926 155.496296 513.21363c0 159.895704 104.675556 295.291259 249.249185 341.485037 10.770963 3.413333 19.569778-2.958222 19.569778-14.260148v-27.83763c0-7.661037-5.688889-16.232296-12.818963-18.887111zM623.122963 171.728593c-10.770963-3.413333-19.569778 2.958222-19.569778 14.260148v27.837629c0 7.585185 5.688889 16.232296 12.818963 18.81126 114.384593 41.870222 196.228741 151.855407 196.228741 280.576 0 128.720593-81.844148 238.629926-196.228741 280.576-7.812741 2.88237-12.818963 10.543407-12.818963 18.811259v27.83763c0 11.301926 8.798815 17.673481 19.569778 14.260148 144.57363-46.193778 249.249185-181.589333 249.249185-341.485037S767.620741 217.92237 623.122963 171.728593z" fill="#FFFFFF" p-id="2051"></path></svg>',J='\n<svg version="1.1" id="img_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 700 700" style="enable-background:new 0 0 700 700;" xml:space="preserve">\n<style type="text/css">\n\t.st0{fill:none;}\n\t.st1{fill:#3FE4CF;}\n</style>\n<g>\n\t<g>\n\t\t<circle class="st0" cx="350" cy="350" r="350"/>\n\t\t<g>\n\t\t\t<path class="st1" d="M350,700C157,700,0,543,0,350S157,0,350,0s350,157,350,350S543,700,350,700z M350,25.9\n\t\t\t\tC171.3,25.9,25.9,171.3,25.9,350S171.3,674.1,350,674.1S674.1,528.7,674.1,350S528.7,25.9,350,25.9z"/>\n\t\t</g>\n\t</g>\n\t<g>\n\t\t<path class="st1" d="M424.6,322.2h-0.2v55.4h0.2c58.2,0,87.8,21.4,87.8,63.7c0,41.4-29.5,62.4-87.8,62.4l-30.8,0V227.4h-87.6v95\n\t\t\tl-30.8,0c-58.2,0-87.8-21-87.8-62.4c0-42.3,29.5-63.7,87.8-63.7h0.2V141h-0.2C186.9,141,134,185.5,134,260\n\t\t\tc0,73.8,52.9,117.8,141.4,117.8l30.8,0v125.8l-126.7,0V559l245.2,0c88.5,0,141.4-44,141.4-117.8\n\t\t\tC566,366.7,513.1,322.2,424.6,322.2z"/>\n\t\t<rect x="306.2" y="141" class="st1" width="214.4" height="55.4"/>\n\t</g>\n</g>\n</svg>\n',Y=[{path:"",component:r}];let q=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[P.Bz.forChild(Y)],P.Bz]}),n})();var z=a(45922),H=a(87841);let K=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[b.ez,L.u5,q,v.c,T.ot,C.Ps,l.t,d.Hi,z.F,H.m]]}),n})()},32681:(W,I,a)=>{a.d(I,{Q:()=>x});var b=a(70022),L=a(94528),P=a(32856),S=a(98538),h=a.n(S),p=a(52909),y=a(48634),V=a(5963),t=a(54004),R=a(5e3),_=a(57610),C=a(11730);let x=(()=>{class f{constructor(u,m){this.accountService=u,this.web3Service=m,this.buyTiUSDReward=0,this.buyTiUSDPersonalReward=0,this.buyTiUSDRewardRate=0,this.buyTiUSDPersonalRewardRate=0,this.holdTiUSDReward=0,this.holdTiUSDPersonalReward=0,this.holdTiUSDRewardRate=0,this.holdTiUSDPersonalRewardRate=0,this.buyTiTiReward=0,this.buyTiTiPersonalReward=0,this.buyTiTiRewardRate=0,this.buyTiTiPersonalRewardRate=0,this.totalClaimableRewards=0,this.distributedTiTiRewards=0,this.APIURL="https://api.thegraph.com/subgraphs/name/titimainnet/titi-use-to-earn",this.client=new b.f({uri:this.APIURL,cache:new L.h}),(0,V.H)(1e4,1e4).pipe((0,t.U)(()=>this.fetchUserData())).subscribe()}fetchUserData(){return Promise.all([this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["0"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["1"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["2"])]).then(([u,m,g])=>(this.currentEpochInfo={epochNum:u[0],duration:u[2],starttime:u[3],holdTiUSDReward:u[1],buyTiTiReward:g[1],buyTiUSDReward:m[1],totalRewards:p.O$.from(u[1]).add(p.O$.from(g[1])).add(p.O$.from(m[1])).toString()},this.currentEpochInfo)).then(({epochNum:u,duration:m,starttime:g,holdTiUSDReward:v,buyTiTiReward:T,buyTiUSDReward:k})=>{const l=1e3*g,d=m/86400,F=parseFloat((0,y.formatUnits)(k,"18")),B=parseFloat((0,y.formatUnits)(v,"18")),O=parseFloat((0,y.formatUnits)(T,"18"));return this.buyTiUSDReward=F,this.buyTiUSDRewardRate=F/d,this.holdTiUSDReward=B,this.holdTiUSDRewardRate=B/d,this.buyTiTiReward=O,this.buyTiTiRewardRate=O/d,this.fetchUserDailyData(u,l,l+1e3*m).then(({data:o})=>{function Z(){let r;const U=(new Date).getTime();return r=U<l?l:U<l+24*d*3600*1e3?U:l+24*d*3600*1e3,r/1e3}this.buyTiUSDPersonalReward=0,this.holdTiUSDPersonalReward=0,this.buyTiTiPersonalReward=0,this.buyTiUSDPersonalRewardRate=0,this.holdTiUSDPersonalRewardRate=0,this.buyTiTiPersonalRewardRate=0,o.user&&o.epochUser&&(o.user.dailyUserMint.forEach(r=>{1e3*(r.dailyMint.dayStartTimestamp+28800)>=l&&1e3*(r.dailyMint.dayStartTimestamp+28800)<l+24*d*3600*1e3&&(this.buyTiUSDPersonalReward+=this.buyTiUSDRewardRate*r.dailyVolume/r.dailyMint.dailyTotalVolume)}),this.holdTiUSDPersonalReward=parseFloat((0,y.formatUnits)(new(h())(o.epochUser.rewards).add(new(h())(o.user.balance).mul(function(r){if(0===Number.parseInt(r.totalSupply))return new(h())(r.rewardPerTokenStored);const U=new(h())(Z()-1*r.lastUpdateTime).mul(new(h())(v)).mul(new(h())("1000000000000000000")).div(new(h())(r.totalSupply).mul(new(h())(86400)).mul(new(h())(d)));return new(h())(r.rewardPerTokenStored).add(U)}(o.holder).sub(new(h())(o.epochUser.userRewardPerTokenPaid))).div(new(h())("10").pow(new(h())("18")))).toString(),"18")),o.user.dailyUserSwap.forEach(r=>{1e3*(r.dailySwap.dayStartTimestamp+28800)>=l&&1e3*(r.dailySwap.dayStartTimestamp+28800)<l+24*d*3600*1e3&&(this.buyTiTiPersonalReward+=this.buyTiTiRewardRate*r.dailyVolume/r.dailySwap.dailyTotalVolume)}),this.buyTiUSDPersonalRewardRate=(new Date).getTime()<l+24*d*3600*1e3&&o.dailyUserMint&&o.dailyUserMint.dailyMint.dailyTotalVolume?this.buyTiUSDRewardRate*o.dailyUserMint.dailyVolume/o.dailyUserMint.dailyMint.dailyTotalVolume:0,this.buyTiTiPersonalRewardRate=(new Date).getTime()<l+24*d*3600*1e3&&o.dailyUserSwap&&o.dailyUserSwap.dailySwap.dailyTotalVolume?this.buyTiTiRewardRate*o.dailyUserSwap.dailyVolume/o.dailyUserSwap.dailySwap.dailyTotalVolume:0,this.holdTiUSDPersonalRewardRate=(new Date).getTime()<l+24*d*3600*1e3?this.holdTiUSDRewardRate*o.user.balance/o.holder.totalSupply:0),this.distributedTiTiRewards=(1e3*Z()-l)/864e5*(this.buyTiUSDRewardRate+this.holdTiUSDRewardRate+this.buyTiTiRewardRate)})})}fetchUserDailyData(u,m,g){return this.accountService.getCurrentAccountAsyn().then(T=>this.client.query({query:(0,P.Ps)("\n    query($userId: ID,$epochUserId: ID,$epochId:ID,$dayId:ID,$startDayId:ID,$endDayId:ID) {\n      epochUser(id:$epochUserId){\n        userRewardPerTokenPaid\n        rewards\n      }\n      user(id:$userId){\n        id\n        address\n        balance\n        dailyUserTransfer(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyTransfer{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserMint(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyMint{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserSwap(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailySwap{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n      }\n      holder(id:$epochId){\n        lastUpdateTime\n        rewardPerTokenStored\n        totalSupply\n      }\n      dailyUserTransfer(id:$dayId){\n        dailyVolume\n        dailyTransfer{\n          dailyTotalVolume\n        }\n      }\n      dailyUserMint(id:$dayId){\n        dailyVolume\n        dailyMint{\n          dailyTotalVolume\n        }\n      }\n      dailyUserSwap(id:$dayId){\n        dailyVolume\n        dailySwap{\n          dailyTotalVolume\n        }\n      }\n   }\n  "),variables:{userId:T.toLowerCase(),epochUserId:u+"-0-"+T.toLowerCase(),epochId:u,dayId:T.toLowerCase()+"-"+Math.floor(((new Date).getTime()-288e5)/864e5),startDayId:T.toLowerCase()+"-"+Math.floor((m-288e5)/864e5),endDayId:T.toLowerCase()+"-"+Math.floor((g-288e5)/864e5)},fetchPolicy:"network-only"}))}}return f.\u0275fac=function(u){return new(u||f)(R.LFG(_.B),R.LFG(C.Uc))},f.\u0275prov=R.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()}}]);